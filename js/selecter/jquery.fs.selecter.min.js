/*
 * Selecter Plugin [Formstone Library]
 * @author Ben Plum
 * @version 2.2.8
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(f){function x(a){a=f.extend({},s,a||{});for(var b=f(this),g=0,c=b.length;g<c;g++){var d=b.eq(g),h=a;if(!d.hasClass("selecter-element")){h=f.extend({},h,d.data("selecter-options"));h.externalLinks&&(h.links=!0);var k=d.find("option, optgroup"),q=k.filter("option"),l=q.filter(":selected"),n=h.defaultLabel?-1:q.index(l),m=h.links?"nav":"div";h.multiple=d.prop("multiple");h.disabled=d.is(":disabled");var e="<"+m+' class="selecter '+h.customClass;p?e+=" mobile":h.cover&&(e+=" cover");e=h.multiple? e+" multiple":e+" closed";h.disabled&&(e+=" disabled");e+='">';h.multiple||(e+='<span class="selecter-selected">',e+=f("<span></span").text(u(h.trimOptions,!1!=h.defaultLabel?h.defaultLabel:l.text())).html(),e+="</span>");e+='<div class="selecter-options">';e+="</div>";e+="</"+m+">";d.addClass("selecter-element").after(e);l=d.next(".selecter");h=d=f.extend({$select:d,$allOptions:k,$options:q,$selecter:l,$selected:l.find(".selecter-selected"),$itemsWrapper:l.find(".selecter-options"),index:n,guid:y++}, h);k="";q=h.links?"a":"span";l=n=0;for(m=h.$allOptions.length;l<m;l++)if(e=h.$allOptions.eq(l),"OPTGROUP"==e[0].tagName)k+='<span class="selecter-group',e.is(":disabled")&&(k+=" disabled"),k+='">'+e.attr("label")+"</span>";else{var t=e.val();e.attr("value")||e.attr("value",t);k+="<"+q+' class="selecter-item';e.is(":selected")&&!h.defaultLabel&&(k+=" selected");e.is(":disabled")&&(k+=" disabled");k+='" ';k=h.links?k+('href="'+t+'"'):k+('data-value="'+t+'"');k+=">"+f("<span></span>").text(u(h.trimOptions, e.text())).html()+"</"+q+">";n++}h.$itemsWrapper.html(k);h.$items=h.$selecter.find(".selecter-item");void 0!=f.fn.scroller&&d.$itemsWrapper.scroller();d.$selecter.on("click.selecter",".selecter-selected",d,z).on("click.selecter",".selecter-item",d,A).on("selecter-close",d,r).data("selecter",d);if(!d.links&&!p||p){if(d.$select.on("change",d,B).on("blur.selecter",d,C),!p)d.$select.on("focus.selecter",d,D)}else d.$select.hide()}}return b}function z(a){a.preventDefault();a.stopPropagation();var b=a.data; if(!b.$select.is(":disabled"))if(f(".selecter").not(b.$selecter).trigger("selecter-close",[b]),p)a=b.$select[0],document.createEvent?(b=document.createEvent("MouseEvents"),b.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(b)):element.fireEvent&&a.fireEvent("onmousedown");else if(b.$selecter.hasClass("closed")){if(a.preventDefault(),a.stopPropagation(),a=a.data,!a.$selecter.hasClass("open")){var b=a.$selecter.offset(),g=f("body").outerHeight(),c=a.$itemsWrapper.outerHeight(!0); b.top+c>g&&a.$selecter.addClass("bottom");a.$itemsWrapper.show();a.$selecter.removeClass("closed").addClass("open");f("body").on("click.selecter-"+a.guid,":not(.selecter-options)",a,E);b=0<=a.index?a.$items.eq(a.index).position():{left:0,top:0};void 0!=f.fn.scroller?a.$itemsWrapper.scroller("scroll",a.$itemsWrapper.find(".scroller-content").scrollTop()+b.top,0).scroller("reset"):a.$itemsWrapper.scrollTop(a.$itemsWrapper.scrollTop()+b.top)}}else b.$selecter.hasClass("open")&&r(a)}function r(a){a.preventDefault(); a.stopPropagation();a=a.data;a.$selecter.hasClass("open")&&(a.$itemsWrapper.hide(),a.$selecter.removeClass("open").addClass("closed"),f("body").off(".selecter-"+a.guid))}function E(a){a.preventDefault();a.stopPropagation();0==f(a.currentTarget).parents(".selecter").length&&r(a)}function A(a){a.preventDefault();a.stopPropagation();var b=f(this),g=a.data;g.$select.is(":disabled")||(g.$itemsWrapper.is(":visible")&&(b=g.$items.index(b),n(b,g,!1)),g.multiple||r(a))}function B(a,b){if(!b){var g=f(this), c=a.data;c.links?p?m(g.val(),c.externalLinks):m(g.attr("href"),c.externalLinks):c.multiple||(g=c.$options.index(c.$options.filter("[value='"+F(g.val())+"']")),n(g,c,!1))}}function D(a){a.preventDefault();a.stopPropagation();a=a.data;a.$select.is(":disabled")||a.multiple||(a.$selecter.addClass("focus"),f(".selecter").not(a.$selecter).trigger("selecter-close",[a]),f("body").on("keydown.selecter-"+a.guid,a,G))}function C(a){a.preventDefault();a.stopPropagation();a=a.data;a.$selecter.removeClass("focus"); f(".selecter").not(a.$selecter).trigger("selecter-close",[a]);f("body").off(".selecter-"+a.guid)}function G(a){var b=a.data;if(b.$selecter.hasClass("open")&&13==a.keyCode)n(b.index,b,!1),r(a);else if(9!=a.keyCode&&!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)){a.preventDefault();a.stopPropagation();var g=b.$items.length-1,c=-1;if(-1<f.inArray(a.keyCode,v?[38,40,37,39]:[38,40]))c=b.index+(38==a.keyCode||v&&37==a.keyCode?-1:1),0>c&&(c=0),c>g&&(c=g);else{a=String.fromCharCode(a.keyCode).toUpperCase(); for(i=b.index+1;i<=g;i++){var d=b.$options.eq(i).text().charAt(0).toUpperCase();if(d==a){c=i;break}}if(0>c)for(i=0;i<=g;i++)if(d=b.$options.eq(i).text().charAt(0).toUpperCase(),d==a){c=i;break}}0<=c&&n(c,b,!0)}}function n(a,b,f){var c=b.$items.eq(a),d=c.hasClass("selected");if(!c.hasClass("disabled")){if(!d||b.links){var h=c.html();c.data("value");if(b.multiple)b.$options.eq(a).prop("selected",!0);else if(b.$selected.html(h),b.$items.filter(".selected").removeClass("selected"),b.$select[0].selectedIndex= a,b.links&&!f){p?m(b.$select.val(),b.externalLinks):m(c.attr("href"),b.externalLinks);return}b.$select.trigger("change",[!0]);c.addClass("selected")}else b.multiple&&(b.$options.eq(a).prop("selected",null),c.removeClass("selected"));if(!d||b.multiple)b.callback.call(b.$selecter,b.$select.val(),a),b.index=a}}function u(a,b){return!1===a?b:b.length>a?b.substring(0,a)+"...":b}function m(a,b){b?window.open(a):window.location.href=a}function F(a){return a.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g, "\\$1")}var y=0,v=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),p=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||window.opera),s={callback:f.noop,cover:!1,customClass:"",defaultLabel:!1,externalLinks:!1,links:!1,trimOptions:!1},w={defaults:function(a){s=f.extend(s,a||{});return f(this)},disable:function(a){return f(this).each(function(b,g){var c=f(g).next(".selecter").data("selecter");if("undefined"!=typeof a){var d=c.$items.index(c.$items.filter("[data-value="+ a+"]"));c.$items.eq(d).addClass("disabled");c.$options.eq(d).prop("disabled",!0)}else c.$selecter.hasClass("open")&&c.$selecter.find(".selecter-selected").trigger("click"),c.$selecter.addClass("disabled"),c.$select.prop("disabled",!0)})},enable:function(a){return f(this).each(function(b,g){var c=f(g).next(".selecter").data("selecter");if("undefined"!=typeof a){var d=c.$items.index(c.$items.filter("[data-value="+a+"]"));c.$items.eq(d).removeClass("disabled");c.$options.eq(d).prop("disabled",!1)}else c.$selecter.removeClass("disabled"), c.$select.prop("disabled",!1)})},destroy:function(){return f(this).each(function(a,b){var g=f(b),c=g.next(".selecter");c.hasClass("open")&&c.find(".selecter-selected").trigger("click");void 0!=f.fn.scroller&&c.find(".selecter-options").scroller("destroy");g.off(".selecter").removeClass("selecter-element").show();c.off(".selecter").remove()})}};f.fn.selecter=function(a){return w[a]?w[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:x.apply(this,arguments)}})(jQuery);